name: Generate Release Assets

on:
  release:
    types: [published]

jobs:
  build-and-upload:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Define target folders üìÅ
        id: folders
        run: |
          echo "folders=linux-amd64 linux-arm64 osx-universal windows-amd64 windows-arm64" >> $GITHUB_OUTPUT

      - name: Compress and Upload Assets üöÄ
        run: |
          for FOLDER in ${{ steps.folders.outputs.folders }}; do
            ASSET_NAME="${FOLDER}.zip"
            FILE_PATH="./lib/${FOLDER}"
            ZIP_PATH="./${ASSET_NAME}"
          
            echo "Processing folder: ${FOLDER}"
          
            # 1. Comprime la carpeta
            zip -r -j -9 "${ZIP_PATH}" "${FILE_PATH}"
          
            if [ -f "${ZIP_PATH}" ]; then
              echo "Successfully created ${ASSET_NAME}"
            else
              echo "Error: Failed to create ${ASSET_NAME}"; exit 1
            fi
          done

      - name: Upload all compressed Assets ‚¨ÜÔ∏è
        uses: softprops/action-gh-release@v2
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: '*.zip'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}